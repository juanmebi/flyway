pipeline {
  agent any 
  environment {
    DB_PROTEOMES=credentials('db-proteomes')
    FLYWAY_LOCATIONS='/usr/local/bin/flyway-9.0.1/sql'
    FLYWAY_URL='jdbc:postgresql://localhost:5432/postgres'
    FLYWAY_USER='postgres'
    FLYWAY_PASSWORD='test'
    FLYWAY_SCHEMAS='public'
    FLYWAY_PATH='/usr/local/bin/flyway-9.0.1'
  }
  stages {
    stage('Build - DB Migration') {
              steps {
                  sh '$FLYWAY_PATH/flyway -user=$FLYWAY_USER -password=$FLYWAY_PASSWORD -url=$FLYWAY_URL -locations=$FLYWAY_PATH/sql migrate'
              }
    }
    stage('Validate - DB Migration') {
              steps {
                  sh '$FLYWAY_PATH/flyway -user=$FLYWAY_USER -password=$FLYWAY_PASSWORD -url=$FLYWAY_URL validate'
              }
    }
    stage('Info') {
              steps {
                  sh '$FLYWAY_PATH/flyway -user=$FLYWAY_USER -password=$FLYWAY_PASSWORD -url=$FLYWAY_URL -locations=$FLYWAY_PATH/sql info'
              }
    }
  }
}
